dojo.provide("dsiglo.peticiones.dutil");

dojo.declare(
"dutil",null,
{
	getAge: function (d1,d2) //YYYY/MM/DD
	{
		var diff = Math.abs(d2.getTime()  - d1.getTime());
		return Math.ceil( diff / (1000 * 3600 * 24) );	
	},
	hoy: function ()
	{
		var today = new Date();
		var dd = today.getDate();
		var mm = today.getMonth()+1; //January is 0!
		var yyyy = today.getFullYear();
		
		if(dd<10) {
		    dd='0'+dd
		} 
		
		if(mm<10) {
		    mm='0'+mm
		} 
		
		today = dd+'/'+mm+'/'+yyyy;
		return today;
	},
	convfecha: function (d1) //DD/MM/YYYY to yyyymmdd
	{
		var ano = d1.substring(6,10);
		var mes = d1.substring(3,5);
		var dia = d1.substring(0,2);
		return ano+mes+dia;
	},	
	sum15fecha: function (d1) //DD/MM/YYYY
	{
		var ano = d1.substring(6,10);
		var mes = d1.substring(3,5);
		var dia = d1.substring(0,2);
		var sum = parseInt(dia);
		if( (parseInt(dia) - parseInt(15))<0 )
		{
			sum = sum + parseInt(15);
			mes = mes - parseInt(1);
		}
		else
		{
			sum = sum - parseInt(15);
		}
		
		//console.log("ini1"+ano+'/'+mes+'/'+dia+'.Suma:'+sum);
		if( mes == "02" )
		{
			if( sum>28)
			{
				sum=sum-28;
				mes=parseInt(mes)-parseInt(1);
			}
			//console.log("ini3"+ano+'/'+mes+'/'+dia+'.Suma:'+sum);
		}
		else if( mes%2 == 0 ) // 30 dias
		{
			if( sum>30)
			{
				sum=sum-30;
				mes=parseInt(mes)-parseInt(1);
				if( parseInt(mes)>12 )
				{ 
					mes = "1";
					ano = parseInt(ano) - parseInt(1);
				}				
			}
			//console.log("ini4"+ano+'/'+mes+'/'+dia+'.Suma:'+sum);
		}
		else
		{
			if( sum>31)
			{
				sum=sum-31;
				mes=parseInt(mes)-parseInt(1);
				if( parseInt(mes)>12 )
				{ 
					mes = "1";
					ano = parseInt(ano) - parseInt(1);
				}		
			}
			//console.log("ini5"+ano+'/'+mes+'/'+dia+'.Suma:'+sum);
		}
		dia=sum;
		dia=parseInt(dia);
		mes=parseInt(mes);
		ano=parseInt(ano);
		if( parseInt(dia)<10 ) dia = "0" +dia;
		if( parseInt(mes)<10 ) mes = "0" +mes;
		//console.log("ini6"+ano+'/'+mes+'/'+dia+'.Suma:'+sum);
		return ano+mes+dia; 
	},
	ltarjetas: function( tipocampo, pdato )
	{
		console.log("Regexp:"+tipocampo+"-"+pdato);
		if( eval(pdato)>0 )
		{
			if( tipocampo=='N') //entero
			{
				return "\\d{"+pdato+"}";
			}
			else if( tipocampo=='T') //Texto
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='X') //Texto Fijo
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='-') //Respetar texto
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='F') //Fecha
			{
				return "(0[1-9]|[12][0-9]|3[01])[- \\/.](0[1-9]|1[012])[- \\/.](19|20)\\d\\d";
			}
			else if( tipocampo=='C') //Cualitativa
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='T1') //T1
			{
				//xxxxxx-x-xxx
				return "(\\d{6}-\\d{1}-\\d{3})";
			}
			else if( tipocampo=='T2') //T2
			{
				//xxxx-xxxx-xxxx-xxxx รณ xxxx-xxxx-x
				return "(\\d{4}-\\d{4}-\\d{1})|(\\d{4}-\\d{4}-\\d{4}-\\d{4})";
			}
			else if( tipocampo=='T3') //T3
			{
				//xx-xxxxxxxxxx
				return "(\\d{2}-\\d{10})";
			}
			else if( tipocampo=='T4') //T4
			{
				//xx/xxxxxxxxx/xx
				return "(\\d{2}/\\d{10}/\\d{2})";
			}
			else if( tipocampo=='T5') //T5
			{
				//xxxx-xxxx o xxxx-xxxx-xxxx-xxxx
				return "(\\d{4}-\\d{4})|(\\d{4}-\\d{4}-\\d{4}-\\d{4})";
				
			}
			else if( tipocampo=='T6') //T6
			{
				//xxxx-xxxxxxxx-xxxxxx
				// o xxxx
				//o xxxxxx-xxxxxx-xxxxxxxx-xxxx
				return "(\\d{4}-\\d{8}-\\d{6})|(\\d{4})|(\\d{6}-\\d{6}-\\d{8}-\\d{4})";
			}
			else if( tipocampo=='T7') //T7
			{
				//xx/xxxxxxxxx/xx
				return "(\\d{2}/\\d{9}/\\d{2})";
			}
			else if( tipocampo=='T8') //T8
			{
				//xxxx-xxxx-xxxx
				//xxxx-xxxx-xxxx-xxxxxx
				return "(\\d{4}-\\d{4}-\\d{4})|(\\d{4}-\\d{4}-\\d{4}-\\d{6})";
			}
			else if( tipocampo=='LF') //Luhn Financiera
			{
				return "\\d{"+pdato+"}";
			}
			else if( tipocampo=='LS') //Luhn Sanitaria
			{
				return "\\d{"+pdato+"}";
			}
			else if( tipocampo=='LX') //Caja Salud
			{
				return "\\d{"+pdato+"}";
			}
		}
		else 
		{
			if( tipocampo=='N') //entero
			{
				return "\\d{"+pdato+"}";
			}
			else if( tipocampo=='T') //Texto
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='X') //Texto Fijo
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='-') //Respetar texto
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='F') //Fecha
			{
				return "(0[1-9]|[12][0-9]|3[01])[- \\/.](0[1-9]|1[012])[- \\/.](19|20)\\d\\d";
			}
			else if( tipocampo=='C') //Cualitativa
			{
				return "\\w{"+pdato+"}";
			}
			else if( tipocampo=='T1') //T1
			{
				//xxxxxx-x-xxx
				return "(\\d{6}-\\d{1}-\\d{3})";
			}
			else if( tipocampo=='T2') //T2
			{
				//xxxx-xxxx-xxxx-xxxx รณ xxxx-xxxx-x
				return "(\\d{4}-\\d{4}-\\d{1})|(\\d{4}-\\d{4}-\\d{4}-\\d{4})";
			}
			else if( tipocampo=='T3') //T3
			{
				//xx-xxxxxxxxxx
				return "(\\d{2}-\\d{10})";
			}
			else if( tipocampo=='T4') //T4
			{
				//xx/xxxxxxxxx/xx
				return "(\\d{2}/\\d{10}/\\d{2})";
			}
			else if( tipocampo=='T5') //T5
			{
				//xxxx-xxxx o xxxx-xxxx-xxxx-xxxx
				return "(\\d{4}-\\d{4})|(\\d{4}-\\d{4}-\\d{4}-\\d{4})";
				
			}
			else if( tipocampo=='T6') //T6
			{
				//xxxx-xxxxxxxx-xxxxxx
				// o xxxx
				//o xxxxxx-xxxxxx-xxxxxxxx-xxxx
				return "(\\d{4}-\\d{8}-\\d{6})|(\\d{4})|(\\d{6}-\\d{6}-\\d{8}-\\d{4})";
			}
			else if( tipocampo=='T7') //T7
			{
				//xx/xxxxxxxxx/xx
				return "(\\d{2}/\\d{9}/\\d{2})";
			}
			else if( tipocampo=='T8') //T8
			{
				//xxxx-xxxx-xxxx
				//xxxx-xxxx-xxxx-xxxxxx
				return "(\\d{4}-\\d{4}-\\d{4})|(\\d{4}-\\d{4}-\\d{4}-\\d{6})";
			}
			else if( tipocampo=='LF') //Luhn Financiera
			{
				return "\\d{"+pdato+"}";
			}
			else if( tipocampo=='LS') //Luhn Sanitaria
			{
				return "\\d{"+pdato+"}";
			}
			else if( tipocampo=='LX') //Caja Salud
			{
				return "\\d{"+pdato+"}";
			}
		}
			
	},
	vgenerali: function( dato )
	{
		console.log("Generali:"+dato);	
	}
}	
);
