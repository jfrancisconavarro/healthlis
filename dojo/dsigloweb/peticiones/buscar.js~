define(["dojo/_base/declare",
"dojo/domReady!"], function(declare){
		dbusqcp1:null,
	dbusqfiltro:null,
	dbusqcarray:null,
	padreBuscar:null,
	dbuscar: function()
	{
		dlgbuscar = new dijit.Dialog({
         title: "Busqueda",
         style: "width: 600px; height: 450px;",
         content: dbusqcp1,
         id: "dlgbuscarbuscar",
         onKeyUp:function(event)
       	{
       		if(event.keyCode==27)
       		{
       			//Al pulsar escape cancela
       			while (dbusqcarray.length) { dbusqcarray.pop(); }
	        	   dlgbuscar.hide();
       		}
       	}
     });
	},
	contenedor1: function ()
	{
		padreBuscar = this;
		dbusqcp1 = new dijit.layout.ContentPane({
        id: "contdbusqueda",
        style: "height: 300px;"
		},dojo.doc.createElement('div'));
	   document.body.appendChild(dbusqcp1.domNode);
	},
	etextbusc: function () 
	{
		textbusq = new dijit.form.ValidationTextBox({
	        name:"textbusq",
	        id:"textbusq",
	        required:false,
	        size:"15",
	        //style: "width:100%;",
	        readonly:false,
	        onKeyUp:function(event)
	       	{
	       		if(event.keyCode==13)
	       		{
						padreBuscar.dbusqactualiza();
	       		}
	       	}
	   }, dojo.doc.createElement('input'));
	   dbusqcp1.domNode.appendChild(textbusq.domNode);
	},
	edbusqtlista: function () 
	{	
	   dbusqtlista = new dojox.grid.DataGrid({
	     id:"dbusqtlista",
		  structure: null,
		  loadingMessage: "Cargando...",
        noDataMessage: "No hay datos",
		  onRowDblClick: function( evento )
		  {
				idx = evento.rowIndex;
				item = this.getItem(idx);
				dbusqcarray[0]=textbusq.get("value");
				dbusqcarray[1]=item.c1;	
				pid.set("value",item.c1,true);				
				dlgbuscar.hide();
		  }
		},dojo.doc.createElement('div'));
   	dbusqcp1.domNode.appendChild(dbusqtlista.domNode);
	},
	settipo: function( tipo, ldbusqcarray )
	{
		dbusqfiltro=tipo;
		//console.log("dbusqfiltro:"+dbusqfiltro+"-"+tipo);
		//console.log("dbusqfiltro2:"+ldbusqcarray);
		dbusqcarray=ldbusqcarray;
		textbusq.set("value",dbusqcarray[0]);
		this.dbusqactualiza();
	},
	dbusqactualiza: function()
	{
		var accion = null;
		switch(dbusqfiltro)
 		{
	 		case "paciente":
	 		var lnombre = [[
				    { name: "DNI", field: "c1", width: "25%", editable: true },
				    { name: "Nombre", field: "c2", width: "25%", editable: true },
					 { name: "Ape1 Ape2", field: "c3", width: "25%", editable: true},
					 { name: "F.Nac", field: "c4", width: "25%", editable: true},
					 { name: "Tel√©fono", field: "c5", width: "25%", editable: true}					 
			    ]];  
			   dbusqtlista.set("structure",lnombre);
				accion="paciente";
	 		break;	 		
	 	}
				require(
				[
				"dojo",
	 			"dojo/data/ItemFileReadStore",
	 			"dojo/request"
	 			], function(dojo,ItemFileReadStore,request)
	  	  		{
	  	  			standby.show();
		          request.get("/petsiglo",{
	 					handleAs: "json",
	 					preventCache: true,
	 					query : { 
	 					 "c1" : dojo.cookie("c1"),
	 					 "c2" : dojo.cookie("c2"),
	 					 "c3" : "busqueda",
	 					 "tipo" : accion,
	 					 "filtro" : textbusq.get("value")
		          }
	 				}).then(function(datos){
	 					StoreSid = new ItemFileReadStore({data: datos});
	 					if( dbusqtlista.get('store')=='' ) { dbusqtlista.store.close(); }
					   dbusqtlista.setStore(StoreSid);
					   dbusqtlista._lastScrollTop=dbusqtlista.scrollTop;
						dbusqtlista._refresh();
						standby.hide();
	 				},
	  				function(error)
	  				{
	 						console.log("Error sexo:"+error);
	 						standby.hide();
	 				});				
			});
	},
	inicio: function () 
	{
		this.contenedor1();
		dbusqcp1.domNode.appendChild(dojo.doc.createElement("p"));
	   this.etextbusc();
	   dbusqcp1.domNode.appendChild(dojo.doc.createElement("p"));
	   this.edbusqtlista();
	   dbusqcp1.startup();
	   this.dbuscar();
	},
	mostrar: function()
	{
		dlgbuscar.show();	
	}
	});
});